<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libEMF: Enhanced Metafile Library</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>libEMF: Enhanced Metafile Library</h1>
<p>
<h3 align="center">1.0.1</h3>
<p>
Table of Contents<ul>
<li><a href="index.html#intro">Introduction</a><li><a href="index.html#whatsnew">What's New?</a><li><a href="index.html#compilation">Compilation</a><li><a href="index.html#documentation">Documentation</a><li><a href="index.html#example">Example</a><li><a href="index.html#acknowledgements">Acknowledgements</a></ul>
<a name="intro"><h2>Introduction</h2></a>

<p>
libEMF is a C/C++ library which provides a drawing toolkit based on <a href="http://www.ecma.ch/ecma1/STAND/ECMA-234.HTM"> ECMA-234</a>. The general purpose of this library is to create vector graphics files on POSIX systems which can be imported into <a href="http://www.sun.com/staroffice/">StarOffice</a>/<a href="http://www.openoffice.org">OpenOffice</a>. The Enhanced MetaFile (EMF) is one of the two color vector graphics format which is "vectorially" understood by SO/OO. (SO/OO can import Encapsulated PostScript files, but will only display it if it has a bitmap preview image. SO/OO can also import a DXF file, but as near as I can tell, this is only monochrome. OpenOffice now has an XML based file format; in the future, use of this format will probably supplant this library.) The EMF format also has the additional advantage that it can be "broken" into its constituent components and edited like any other SO/OO graphics object.
<p>
My general interest in this library is for making scientific plots with <a href="http://www.gnuplot.org/">gnuplot</a> and <a href="http://plasma-gate.weizmann.ac.il/Grace/">Grace</a>(forthcoming). Therefore, this software includes patches to those programs to add the EMF as an output option. This library is mostly limited to the graphics commands required for gnuplot and Grace output drivers, though it's trivial to add new ones.
<p>
It is also possible now to generate EMF files from <a href="http://www.pstoedit.net/pstoedit/">PSTOEDIT</a> on POSIX systems. Therefore, if your graphics code only outputs PostScript, you can now easily convert it to EMF.
<p>
<a href="http://sourceforge.net/projects/libemf">libEMF is hosted on SourceForge.</a> If you have questions or comments, try out the <a href="mailto:libemf-devel@lists.sourceforge.net">libEMF mailing list.</a>
<p>
<a name="whatsnew"><h2>What's New?</h2></a>

<p>
Version 1.0.1 is minor update. libEMF has been updated to compile cleanly with GCC 3.x. The header files have been reorganized slightly so that if the headers are installed in /usr/include, you do not need an extra -I option. You should now access libEMF headers with:
<p>
<div class="fragment"><pre><font class="preprocessor">#include &lt;libEMF/emf.h&gt;</font></pre></div>
<p>
<a name="compilation"><h2>Compilation</h2></a>

<p>
libEMF uses a standard autoconf-generated configure script to prepare it for compilation. If you want to activate printing of EMF records, run the configure script with: <div class="fragment"><pre>./configure --enable-editing</pre></div>
<p>
A single program is provided which can print the complete contents of a metafie (as far as the library understands them, anyway),
<p>
<div class="fragment"><pre>printemf metafile.emf</pre></div>
<p>
<a name="documentation"><h2>Documentation</h2></a>

<p>
The documentation of this project is generated with Doxygen and is largely for the internals of the library. However, the graphics commands which are available from C are <a href="libemf_8cpp.html"> given here</a>.
<p>
<a name="example"><h2>Example</h2></a>

<p>
You will probably only use libEMF in the context of an output driver for another graphics program, but should you want to do some custom graphics generation, here is an annotated example.
<p>
<div class="fragment"><pre><font class="preprocessor">#include &lt;libEMF/emf.h&gt;</font> <font class="comment">// Will depend on your installation of libEMF</font>

<font class="keywordtype">int</font> main ( <font class="keywordtype">int</font> argc, <font class="keywordtype">char</font>* argv[] )<font class="keyword"></font>
</font>{</pre></div>
<p>
The first step is to create a device context for the metafile. The usual way this is accomplished is by acquiring a copy of the "desktop" device context and using it as a starting point for the metafile device context. libEMF supports the commands GetDesktopWindow() and GetDC(), but they are just dummy functions. The metafile device context has its own internal definitions.
<p>
The metafile creation subroutine takes four arguments (the first of which, the reference device context as obtained above, is ignored). The second argument is the path name of the metafile; you can use whatever name is valid on the system, but SO/OO prefers the file to end with the .emf extension. The third argument gives the size and position of the metafile; since SO/OO ignores the position, the first two values should be zero; the second pair of values should give the desired physical width and height of the drawing in units of 1/1000-th centimeters. The last argument to the creation routine is the description of the metafile; by convention, this consists of two null-terminated strings with an extra '\0' at the end.
<p>
<div class="fragment"><pre>   HWND desktop = GetDesktopWindow();
   HDC dc = GetDC( desktop );

   RECT size = { 0, 0, 10000, 10000 }; <font class="comment">// 10cm x 10cm</font>
   PCSTR filename = <font class="stringliteral">"example.emf"</font>;
   PCSTR description = <font class="stringliteral">"Example metafile created\0with libEMF\0"</font>;

   HDC metaDC = CreateEnhMetaFile( 0, filename, &amp;size, description );</pre></div>
<p>
Next, we want to set the drawing properties of the pen, brush and font to something other than the default, say a wide, cyan pen and a solid, blue brush, and a bold Helvetica font.
<p>
<div class="fragment"><pre>   LOGPEN lpen = { PS_SOLID, {2000,2000}, RGB(0,0xff,0xff) };
   LOGBRUSH lbrush = { BS_SOLID, RGB(0x0,0x0,0xff), HS_HORIZONTAL };
   HPEN pen = CreatePenIndirect( &amp;lpen );
   HBRUSH brush = CreateBrushIndirect( &amp;lbrush );
   HFONT font = CreateFont( -1100, 0, 0, 0, FW_BOLD, 0, 0, 0, ANSI_CHARSET,
                      OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS, DEFAULT_QUALITY,
                      DEFAULT_PITCH | FF_DONTCARE, <font class="stringliteral">"Helvetica"</font> );

   <font class="comment">// Make these the active objects for their respective types</font>

   SelectObject( metaDC, pen );
   SelectObject( metaDC, brush );
   SelectObject( metaDC, font );</pre></div>
<p>
Set the window size to the natural coordinates of the drawing. Here, we want to draw on a 100x100 grid.
<p>
<div class="fragment"><pre>   SetWindowExtEx( metaDC, 100, 100, 0 );</pre></div>
<p>
Now, we can draw as we like. For example, we'll make a solid background with some text centered in the window.
<p>
<div class="fragment"><pre>   Rectangle( metaDC, 0, 0, 100, 100 );

   SetTextColor( metaDC, RGB(0,0xff,0) );
   SetTextAlign( metaDC, TA_CENTER+TA_BASELINE );
   SetBkMode( metaDC, TRANSPARENT );
   TextOutA( metaDC, 50, 50, <font class="stringliteral">"Welcome to libEMF"</font>, 17 );</pre></div>
<p>
Finally, the metafile is written to disk when the metafile is closed. Delete the metafile and its assocated device context to free all the memory they have consumed.
<p>
<div class="fragment"><pre>   metafile = CloseEnhMetaFile( metaDC );
   DeleteEnhMetaFile( metafile );
   DeleteDC( metaDC );

   <font class="keywordflow">return</font> 0;
}</pre></div>
<p>
This is result of importing example.emf into OO and exporting the drawing as a PNG file (after using The GIMP to crop the transparent boundary).
<p>
<div align="center">
<img src="example.png" alt="example.png">
</div>
 <a name="acknowledgements"><h2>Acknowledgements</h2></a>

<p>
Special thanks to Wolfgang Glunz (<a href="mailto:wglunz@pstoedit.net">wglunz@pstoedit.net</a>) for suggestions and help testing.
<p>
<hr> Copyright &copy; 2002 lignum Computing, Inc., <a href="mailto:libemf@lignumcomputing.com"><a href="mailto:libemf@lignumcomputing.com">libemf@lignumcomputing.com</a></a>
<p>
<hr> Hosted by <a href="http://sourceforge.net"> <IMG src="http://sourceforge.net/sflogo.php?group_id=30708" width="88" height="31" align="middle" border="0" alt="SourceForge Logo"></a>
<p>
<hr><address><small>Generated at Mon Jan 13 21:34:19 2003 for EMF by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
